# Оценка риска ликвидности портфеля ценных бумаг
Над проектом работали:
Завидонова Даниела Андреевна
Смирнов Артём Арнольдович
Постановка задачи
Изучить от чего зависит ликвидность портфеля, какие есть способы оценки риска ликвидности портфеля, реализовать несколько методов оценки ликвидности и провести сравнение результатов.

## Теоретическая часть

### Понятия, с которыми будем работать, их взаимосвязь

- Характеристики портфеля ценных бумаг влияющие на ликвидность:
  - Цена спроса: максимальная цена, которую инвестор готов заплатить за ценную бумагу

  - Цена предложения: минимальная цена, по которой кто-то готов продать эту бумагу

  - Ценовой спрэд (spread): «разброс», разница между спросом (bid price) на ценную бумагу и предложением (ask price). Вычисляется в деньгах или процентах (100*(ask_price - bid_price)/ask_price). Более показательным считается значение, выраженное в процентах от первоначальной стоимости. Когда спред между ценами покупки и продажи уменьшается, количество сделок увеличивается, следовательно, ценная бумага становится более ликвидной. Спред может быть большим из-за каких-то особых событий - праздники, перед выходом нового закона и тд. В таких случаях это может быть краткосрочным увеличением. Также спред увеличивается, если крупный покупатель начинает скупать большой объем какой-то ценной бумаги. Или наоборот — когда спрос становится сильно ниже предложения (никто не хочет или не может купить эту бумагу).

- Ликвидность: способность быстро и без больших потерь обратить весь портфель или его часть в денежные средства или возможность своевременного погашения обязательств, возникших при его формировании.
- Риск ликвидности: возможность потерь при реализации (продаже) ценных бумаг. Возможно два случая: снижение предполагаемой цены реализации акции или(и) невостребованность бумаг на рынке. Какие события могут привести к риску ликвидности:
  Если кто-то выкупает значимую часть акций: компания проводит байбэк (выкупает собственные акции с рынка) - количество ценных бумаг, которые могут купить инвесторы, уменьшается, следовательно, ликвидность падает. Большую долю выкупают крупные инвесторы - это аналогичным образом влияет на количество акций в обращении и объем торгов.
  Если показатели компании снижаются из-за операционной деятельности или если компания переживает внешнеторговые потрясения: инвесторы стремятся продать бумагу, но не все захотят ее купить
- Основные характеристики ликвидности:
  - Вязкость (Сжатость): отклонение цены сделки от средней рыночной цены, измеряется с помощью ценового спрэда. 
  - Глубина: максимальный объем сделки, осуществление которой не оказывает большого влияния на ситуацию на рынке (обычно показателем является объем торгов), следовательно, рынку с большей ликвидностью соответствует большая глубина. 
  - Восстановление (Релаксация): скорость, с которой после проведения какой-либо операции исчезает изменчивость цен, либо устраняется дисбаланс между ценой спроса и предложения. Одним из подходов к измерению восстановления является нахождение скорости восстановления нормальных рыночных условий (спрэда и объема заказов) после заключения сделки. 
  - Немедленность рынка: время между размещением заявки и ее исполнением 
  - Также есть показатель free-float: доля акций компании, которые могут приобрести частные инвесторы. Чем выше free-float, тем больше объем торгов и выше ликвидность ценной бумаги. Не является основной характеристикой.

### Как оценить риск ликвидности
Для эффективного моделирования риска рыночной ликвидности необходимо учитывать четыре основных аспекта ликвидности.

Одним из наиболее распространённых способов оценки риска ликвидности является подсчёт VaR.
Показатель VaR является мерой риска и определяется как квантиль случайной велечины, равной доходности ценной бумаги или портфеля бумаг на заданный момент времени t за заданный период n. Смысловое значение VaR: величина убытков (выраженная в долях или процентах от первоначальной стоимости), которая с вероятностью, равной уровню доверия alpha, не будет превышена в течение n дней.  
Чаще всего используют именно эту меру риска, так как для поиска этой оценки используются стандартные математические методы, что позволяет более широко применять этот метод.

VaR можно посчитать несколькими способами:
- Исторический: исходя из предположения, что дальнейшее распределение доходностей акции не изменится, берём распределение доходностей основываясь на исторических данных.
- Параметрический: исходим из предположения, что мы знаем распределение доходностей (чаще предполагают нормальное) и расчитываем VaR исходя из этого.
- Метод Монте-Карло: используются исторические данные для оценки распределения доходностей активов в портфеле и генерируются случайные сценарии будущих доходностей на основе выбранного распределения. Для каждого сгенерированного сценария рассчитайте новое значение портфеля путем применения случайных доходностей к текущей стоимости портфеля.

К сожалению, VaR плохо учитывает ограничения, связанные с ликвидностью рынка, так как все вычисления делаются из предположения что нет дополнительных факторов, вызывающих изменения цены во время сделки (нет колебаний). На практике такие факторы обычно есть, чтобы их учесть используют разные модификации VaR и параметры, учитывающие ликвидность.

VaR c параметрами, позволяющими более точно учесть ликвидность называется LVaR (VaR с учетом ликвидности).

Существует несколько способов посчитать LVaR, приведём ряд из них:
- Исторический метод. Анализируя исторические данные о ценах активов и объемах торгов, можно оценить, как ликвидность могла бы повлиять на цены в условиях рыночного стресса.
- Стресс-тестирование. Можно провести стресс-тесты для оценки воздействия различных шоков на ликвидность портфеля. Это может помочь понять, как портфель будет вести себя в условиях рыночной нестабильности. 
- Модели рынка. Можно использовать модели рынка (например Амадор-Гарсиа), чтобы оценить влияние ликвидности на стоимость активов - метод даёт хорошие результаты, но сложен в реализации. 
- Метод Монте-Карло. Подобно стандартному VaR, можно использовать метод Монте-Карло для моделирования сценариев, в которых учитываются не только доходности активов, но и их ликвидность. Это включает в себя генерацию случайных сценариев цен с учетом ликвидности и оценку потенциальных потерь.

## Практическая часть
В качестве практической части мы провели сравнительный анализ следующих оценок риска ликвидности портфеля: VaR и LVaR.
Был посчитан VaR историческим методом для каждой элемента портфеля, был посчитан суммарный VaR портфеля.
Был посчитан LVaR историческим методом для каждого элемента портфеля и суммарный LVaR портфеля.
Был посчитан LVaR методом Монте-Карло для каждого элемента портфеля и суммарный LVaR портфеля.
Проведён сравнительный анализ.

### Предобработка данных
Ответственный: Смирнов Артём Арнольдович
В качестве данных были взяты акции топ 10 компаний по чистой прибыли в год за 2024 год, ориентировались на данный ресурс https://www.forbes.ru/biznes/521880-100-krupnejsih-kompanij-rossii-po-cistoj-pribyli-2024-rejting-forbes.

Для обработки данных обычно используется библиотека yfinance, но воспользоваться ей не удалось по техническим проблемам.
Поэтому данные выгружались вручную с ресурса https://ru.investing.com/equities/pharmsynthez-historical-data и форматировались так же вручную.

Для реализации нам потребуются следующие библиотеки:


Была проведена фильтрация данных и реализован блок кода, позволяющий выгружать все необходимые данные и превращать их в отредактированный массив.

### Подсчёт стандартного VaR
Ответственный: Завидонова Даниела Андреевна, Смирнов Артём Арнольдович
В качестве значения alpha выберем число 97% (то есть с вероятностью 97% убытки не превысят значения, рассчитанного с помощью оценки).
Для подсчёта использовался исторический метод.
Данные выгружаются с 2016 года по 2024 для компаний Сбербанк, Газпром, Магнит, Норильский никель, Лукойл, Новатэк, Роснефть, Татнефть, ВТБ.
В результате получаем следующие данные (более подробный расчёт и графики доходности каждой компании можно посмотреть на нашем гитхабе https://github.com/Daniela0531/finance_commission/tree/main):

Теперь рассчитаем VaR всего портфеля

В результате были получены следующие данные:

Построим график доходности портфеля целиком
### Подсчёт LVaR
Ответственный: Завидонова Даниела Андреевна, Смирнов Артём Арнольдович
Как было описано в теоретической части работы чаще всего для подсчёта LVaR используется VaR с какими-то дополнительными параметрами, позволяющими учесть ликвидность. Одним из подходов к решению данной задачи является подсчет VaR по измененным данным таким образом, что он уже учитывает риск ликвидности.
В данном случае показателем самой ликвидности будет разница между LVaR и VaR (или их отношение, если хотим понять насколько ликвидность увеличивает риск).

Рассчитывается изменение цены акции за k=2 дней с помощью логарифмической функции и использования нормального распределения, используя среднюю цену спроса и предложения в день.
Разница спроса и предложения это спред, следовательно мы получаем отношение спреда новой цены к старой, то есть значение, отображающее как изменилась ликвидность за эти k дней (чем меньше спред, тем больше ликвидность).

Более подробно можно посмотреть на нашем гитхабе https://github.com/Daniela0531/finance_commission/tree/main.

LVaR каждого элемента портфеля:



Аналогичным образом рассчитываем LVaR всего портфеля

Оценка ликвидности каждого элемента портфеля, абсолютная и относительная:

Оценка ликвидности портфеля, абсолютная и относительная

### Подсчёт LVaR с помощью метода Монте-Карло
Ответственный: Завидонова Даниела Андреевна
Вычислияем среднюю доходность и стандартное отклонение доходностей акций.
Определите параметры ликвидности, такие как средний объем торгов и спред.
После этого генерируем случайные сценариии цен акций, используя нормальное распределение с рассчитанными ранее средней доходностью и стандартным отклонением, с учётом ликвидности: при каждом сценарии моделируется, как изменение объема торгов или спреда повлияет на цены.

Для каждого сценария определяем, какова будет цена акций в условиях низкой ликвидности (например, увеличении спреда или уменьшении объема торгов).

Далее рассчитываем потенциальные потери, их среднее значение.

Получаем LVaR (величина убытков с вероятностью 97% не превысит эти значения).


Далее аналогичным образом считаем LVaR методом Монте-Карло для всего портфеля:

Получаем следующий результат:

## Выводы
В результате работы была изучена ликвидность компаний.
Были реализованы оценки ликвидности и проведён их сравнительный анализ.
Риск ликвидности ценной бумаги оказывает влияние на ликвидность всего портфеля, ликвидность портфеля значительно меньше, чем ликвидность каждой акции в отдельности..
Из всех оценок самой оптимистичной оценкой оказалась оценка методом Монте-Карло.
Литература
Что такое спред и на что он влияет https://gazprombank.investments/blog/market/spred/
Оценка рыночного риска портфеля https://habr.com/ru/articles/506044/
Способы выгрузки данных https://habr.com/ru/articles/543506/
Данные об акциях компаний https://ru.investing.com/equities/pharmsynthez-historical-data
Топ компаний по обороту денег за 2020 год https://raex-rr.com/largest/RAEX-600/biggest_companies/2022/
Топ компаний по чистой прибыли за 2024 год https://www.forbes.ru/biznes/521880-100-krupnejsih-kompanij-rossii-po-cistoj-pribyli-2024-rejting-forbes.
Измерение риска рыночной ликвидности https://cyberleninka.ru/article/n/izmerenie-riska-rynochnoy-likvidnosti-portfelya-rynochnyh-tsennyh-bumag/viewer
